---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 10-LinReg.md in _episodes_rmd/
title: "Linear Regression. "
author: "Darya Vanichkina"
exercises: 0
keypoints: 
- Regression is the prediction of the value of a continuous variable based on one or more other continuous or categorical variables.
- Multiple types of regression can be implemented to fit the data
objectives: 
- Introduce several approaches to carrying out linear regression in R
- Introduce and explore the Ames Housing dataset
questions: 
- How do we predict one continuous variable based on others?
- What is the first step of any ML project (and often the most time consuming)?
source: Rmd
start: 0
teaching: 30
bibliography: references.bib
---



```r
# set knitr options
# opts_knit$set(warning = FALSE, message = FALSE)
  
library(tidyverse)
```

```
## ── Attaching packages ────────────────────────────────── tidyverse 1.2.1 ──
```

```
## ✔ ggplot2 3.1.0       ✔ purrr   0.3.1  
## ✔ tibble  2.0.1       ✔ dplyr   0.8.0.1
## ✔ tidyr   0.8.3       ✔ stringr 1.4.0  
## ✔ readr   1.3.1       ✔ forcats 0.4.0
```

```
## Warning: package 'tibble' was built under R version 3.5.2
```

```
## Warning: package 'tidyr' was built under R version 3.5.2
```

```
## Warning: package 'purrr' was built under R version 3.5.2
```

```
## Warning: package 'dplyr' was built under R version 3.5.2
```

```
## Warning: package 'stringr' was built under R version 3.5.2
```

```
## Warning: package 'forcats' was built under R version 3.5.2
```

```
## ── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
```

```r
library(caret)
```

```
## Loading required package: lattice
```

```
## 
## Attaching package: 'caret'
```

```
## The following object is masked from 'package:purrr':
## 
##     lift
```

```r
library(tidymodels)
```

```
## ── Attaching packages ───────────────────────────────── tidymodels 0.0.2 ──
```

```
## ✔ broom     0.5.1     ✔ recipes   0.1.4
## ✔ dials     0.0.2     ✔ rsample   0.0.4
## ✔ infer     0.4.0     ✔ yardstick 0.0.3
## ✔ parsnip   0.0.1
```

```
## Warning: package 'rsample' was built under R version 3.5.2
```

```
## Warning: package 'yardstick' was built under R version 3.5.2
```

```
## ── Conflicts ──────────────────────────────────── tidymodels_conflicts() ──
## ✖ scales::discard()      masks purrr::discard()
## ✖ dplyr::filter()        masks stats::filter()
## ✖ recipes::fixed()       masks stringr::fixed()
## ✖ dplyr::lag()           masks stats::lag()
## ✖ caret::lift()          masks purrr::lift()
## ✖ yardstick::precision() masks caret::precision()
## ✖ yardstick::recall()    masks caret::recall()
## ✖ yardstick::spec()      masks readr::spec()
## ✖ recipes::step()        masks stats::step()
```

```r
library(AmesHousing)
```


```
## Error in strata %in% vars: object 'ameshousingFilt' not found
```

```
## Error in analysis(x): object 'ames_split' not found
```

```
## Error in assessment(x): object 'ames_split' not found
```


## Use the (new, tidy) recipes package for feature engineering


```r
engineer_features_allames <-
  recipe(Sale_Price ~ ., data = ameshousingFiltTrain) %>%
  step_log(Sale_Price) %>% # log(Sale_Price)
  step_nzv(all_nominal()) %>% # removes variables that are highly sparse or unbalanced
  step_zv(all_nominal()) %>% 
  step_integer(matches("Qual|Cond|QC|Qu")) %>%
  step_center(all_numeric(), -all_outcomes()) %>%
  step_scale(all_numeric(), -all_outcomes()) %>%
  step_dummy(all_nominal(), -all_outcomes(), one_hot = TRUE)
```

```
## Error in is_tibble(data): object 'ameshousingFiltTrain' not found
```

```r
# Train a Data Recipe
engineer_features_allames_prep <- prep(engineer_features_allames, training = ameshousingFiltTrain, verbose = TRUE)
```

```
## Error in prep(engineer_features_allames, training = ameshousingFiltTrain, : object 'engineer_features_allames' not found
```

```r
# get the transformed training dataset
ameshousingFiltTrain_engineered <- juice(engineer_features_allames_prep)
```

```
## Error in fully_trained(object): object 'engineer_features_allames_prep' not found
```

```r
# apply the same transformation onto the test set (with the TRAINING parameters)
ameshousingFiltTest_engineered <- bake(engineer_features_allames_prep, new_data = ameshousingFiltTest)
```

```
## Error in bake(engineer_features_allames_prep, new_data = ameshousingFiltTest): object 'engineer_features_allames_prep' not found
```

```r
# use caret to specify cross-validation
ames_resamplingCV <- trainControl(
  method = "repeatedcv", 
  number = 10, #  k = 10
  repeats = 7 # repeat 7 times
  )
```


> ## Challenge
>
> 1. Look at (and explore) the code for the recipe above. What are each of the steps doing?
> Use the ?help to assist you with this.
> 
> 2. 
> {: .source}
>
> > ## Solution
> > 
> > We will discuss this as a group.
> > 
> > {: .output}
> {: .solution}
{: .challenge}


## Fitting a model

There are currently 237 types of ML models than can be fit using the `caret` package. To see a list of these, and to explore what tuning parameters they might need, [see here](https://topepo.github.io/caret/available-models.html). You can also [define your own model](https://topepo.github.io/caret/available-models.html).




### Simple linear regression


```r
# predict sale price based on Gr_Liv_Area
set.seed(42)
ames_lm1 <- train(
  Sale_Price ~ Gr_Liv_Area,
  data = ameshousingFiltTrain_engineered,
  method = "lm",
  trControl = ames_resamplingCV)
```

```
## Error in eval(expr, p): object 'ameshousingFiltTrain_engineered' not found
```

```r
summary(ames_lm1)
```

```
## Error in summary(ames_lm1): object 'ames_lm1' not found
```

```r
ames_lm1
```

```
## Error in eval(expr, envir, enclos): object 'ames_lm1' not found
```

```r
basicLm <- lm(Sale_Price ~ Gr_Liv_Area, data = ameshousingFiltTrain_engineered)
```

```
## Error in is.data.frame(data): object 'ameshousingFiltTrain_engineered' not found
```

```r
# implement as function

myLinearRegression <- function(formula){
set.seed(42)
tmp <-  train(
  formula,
  data = ameshousingFiltTrain_engineered,
  method = "lm",
  trControl = ames_resamplingCV)
print(summary(tmp))
return(tmp)
}
ames_lm1 <- myLinearRegression(Sale_PriceLog ~ Gr_Liv_Area)
```

```
## Error in eval(expr, p): object 'ameshousingFiltTrain_engineered' not found
```





Use Second_Flr_SF and Gr_Liv_Area to predict:


```r
ames_lm2 <- myLinearRegression(Sale_PriceLog ~ Gr_Liv_Area + Second_Flr_SF)
```

```
## Error in eval(expr, p): object 'ameshousingFiltTrain_engineered' not found
```


```r
ames_lm2i <-  myLinearRegression(Sale_PriceLog ~ Gr_Liv_Area + Second_Flr_SF +Gr_Liv_Area:Second_Flr_SF)
```

```
## Error in eval(expr, p): object 'ameshousingFiltTrain_engineered' not found
```




```r
ames_lm2year <-  myLinearRegression(Sale_PriceLog ~ Gr_Liv_Area + Year_Built)
```

```
## Error in eval(expr, p): object 'ameshousingFiltTrain_engineered' not found
```



All predictors


```r
ames_lm_all <- myLinearRegression(Sale_PriceLog ~. )
```

```
## Error in eval(expr, p): object 'ameshousingFiltTrain_engineered' not found
```

Compare performance on training set:


```r
allResamples <- resamples(list("Gr_Liv_Area cv" = ames_lm1, 
                               "Gr_Liv_Area + Year_Built" = ames_lm2year,
                               "Gr_Liv_Area + Second_Flr_SF" = ames_lm2,
                               "Gr_Liv_Area:Second_Flr_SF" = ames_lm2i,
                               "All vars" = ames_lm_all
                               ))
```

```
## Error in resamples(list(`Gr_Liv_Area cv` = ames_lm1, `Gr_Liv_Area + Year_Built` = ames_lm2year, : object 'ames_lm1' not found
```

```r
bwplot(allResamples)
```

```
## Error in bwplot(allResamples): object 'allResamples' not found
```

```r
parallelplot(allResamples)
```

```
## Error in parallelplot(allResamples): object 'allResamples' not found
```

```r
parallelplot(allResamples , metric = "Rsquared")
```

```
## Error in parallelplot(allResamples, metric = "Rsquared"): object 'allResamples' not found
```

```r
parallelplot(allResamples , metric = "RMSE")
```

```
## Error in parallelplot(allResamples, metric = "RMSE"): object 'allResamples' not found
```









## References


  
  
